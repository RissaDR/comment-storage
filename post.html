<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
  </head>
  <body class="bg-dark text-white">
    <div class="container">
        <h1 class="mb-3"><b>POSTS</b></h1>
        <div id="posts"></div>
        

    </div>
    <script src="https://www.gstatic.com/firebasejs/7.14.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.14.2/firebase-firestore.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
  </body>
  <script>

    let posts;
    var placeholder = document.getElementById("posts");
    var i = 0;
    async function fet() {

        placeholder.innerHTML = `
        <div class="d-flex justify-content-center my-3" id="commentsSpinner">
            <div class="spinner-border" role="status">
            </div>
        </div>`

        const res = await fetch("https://script.google.com/macros/s/AKfycbxc570A20FffNbLkC0z8xlsIOcqOjmRPH4wQ9DhBrqwbUV8HIIHQR01bimJDsBEzzEniA/exec");
    
        comments = await res.json();
    
        console.log(comments);

        var content = ""

        
        for (key in comments) {
            i += 1;
            
            console.log(key);
            console.log(comments[key].name);
            console.log(comments[key]["comment"]);

            var card = `<a href="/comment-storage/comments.html?id=${key}">${key}</a>`
            content += card;
            //var newDiv = document.createElement('div');
            //newDiv.innerHTML += `comments (${i}): ${key}`;)
            //placeholder.appendChild(newDiv);

        }
        placeholder.innerHTML = content;
        

    }

    fet();

    document.getElementById('commentForm').addEventListener('submit', postComment);

    //const myModal = document.getElementById('exampleModal')
    //const myModal = new bootstrap.Modal(document.getElementById('exampleModal'));
    const myModal = new bootstrap.Modal('#exampleModal');
    const successModal = new bootstrap.Modal('#successModal');
    const errorModal = new bootstrap.Modal('#errorModal');

    function postComment (event) {
        event.preventDefault();

        const name = document.getElementById('name').value;
        const content = document.getElementById('content').value;
        const date = new Date()

        const XHR = new XMLHttpRequest();
        form = document.getElementById('commentForm');

        XHR.addEventListener("loadstart", (event) => {
            var formName = document.getElementById("name");
            formName.value = ""
            var formName2 = document.getElementById("content");
            formName2.value = ""
            myModal.show();
        
        });

        XHR.addEventListener("load", (event) => {
            //fet();
            placeholder.innerHTML += `<div class="card text-white border-light bg-dark mb-3">
                <div class="card-body">
                    <h5 class="card-title"><b>${name}</b> says: </h5>
                    <h6 class="card-subtitle mb-2 text-warning">${date}</h6>
                    <p class="card-text mb-2 text-body-secondary">${content}</p>
                 </div>
            </div>`
            myModal.hide();
            successModal.show();
        })

        

        XHR.addEventListener("error", (event) => {
            myModal.hide();
            errorModal.show();
        });
        
        // FD.append("thisVariableIsForAppsScriptEmail", thisIsMyVariableCalledEmail);
        // FD.append("thisVariableIsForAppsScriptName", thisIsMyVariableCalledName);

        XHR.open("POST", "https://script.google.com/macros/s/AKfycbwoy5bKoq4T1LeWh5Bw2yvk4DTW5IbTZoC0GcUGZbp9IaH6SRflke8X0HzqnJNa4b1r/exec");
        
        jsondata = JSON.stringify({
                "name": name,
                "content": content,
                "date": date,
            });
            
        XHR.send(jsondata);

    }
</script>
</html>